# .github/workflows/build-mac-intel.yml
name: Build macOS (Intel x64)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-mac-intel:
    name: Build macOS (Intel x64)
    runs-on: macos-13

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # ── Python / PyInstaller ────────────────────────────────────────────────
      - name: Set up Python 3.12
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: Install lipidimea dependencies
        run: |
          cd lipidimea
          python -m pip install --upgrade pip
          # adjust if you have a requirements.txt
          pip install .

      - name: Install PyInstaller
        run: pip install pyinstaller

      - name: Build experiment.py into a single executable
        working-directory: gui
        run: |
          # this will produce gui/embeddedPythonMac/experiment (or .exe on Windows)
          pyinstaller \
            --clean \
            --noconfirm \
            --onefile \
            --distpath embeddedPythonMac \
            experiment.spec

      # ── Electron / Forge ────────────────────────────────────────────────────
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: Install GUI dependencies
        working-directory: gui
        run: npm install

      - name: Build macOS Intel (x64) DMG
        working-directory: gui
        run: npm run make-x64

      # ── Upload Artifact ─────────────────────────────────────────────────────
      - name: Upload macOS Intel Artifact
        uses: actions/upload-artifact@v4
        with:
          name: mac-intel-dmg
          path: /Users/runner/work/lipid_gui_private/lipid_gui_private/gui/out/make/dia_dda_application-0.12.26-x64.dmg

